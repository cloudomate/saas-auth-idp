# =============================================================================
# SaaS Auth Example - Environment Configuration
# =============================================================================
# Copy this file to .env and fill in your values before running docker-compose
#
# Architecture:
# - Casdoor: Identity Provider (users, social login, SSO)
# - Traefik: API Gateway (routing, ForwardAuth)
# - AuthZ Service: JWT validation + OpenFGA permission checks
# - OpenFGA: Fine-grained authorization (ReBAC/ABAC)
# - Sample API: Business logic (trusts headers from AuthZ)
# =============================================================================

# -----------------------------------------------------------------------------
# Application URLs
# -----------------------------------------------------------------------------
# Frontend URL (React app)
APP_URL=http://localhost:3000

# API Gateway URL (Traefik - use this for API calls)
GATEWAY_URL=http://localhost:4455

# Direct API URL (sample-api - for internal use)
API_URL=http://localhost:8001

# -----------------------------------------------------------------------------
# Database Configuration
# -----------------------------------------------------------------------------
POSTGRES_USER=examples
POSTGRES_PASSWORD=examples_password
POSTGRES_DB=examples

# -----------------------------------------------------------------------------
# Identity Provider Configuration
# -----------------------------------------------------------------------------
# Auth endpoint (via gateway - no direct access to IDP UI)
CASDOOR_ENDPOINT=http://localhost:4455
CASDOOR_ORIGIN=http://localhost:4455

# Default Admin Credentials (seeded from init_data.json):
#   Email: admin@localhost
#   Password: admin123
# IMPORTANT: Change the admin password after first login!

# OAuth Client Configuration (for social login)
CASDOOR_CLIENT_ID=
CASDOOR_CLIENT_SECRET=

# Organization (default: saas-platform)
CASDOOR_ORGANIZATION=saas-platform

# Application name
CASDOOR_APPLICATION=saas-app

# -----------------------------------------------------------------------------
# Auth Mode Configuration
# -----------------------------------------------------------------------------
# AUTH_MODE controls how the sample-api validates authentication:
# - "gateway" (default): Trusts headers from Traefik/AuthZ service
#   (X-User-ID, X-Tenant-ID, X-Is-Platform-Admin, etc.)
# - "direct": Validates Casdoor JWT tokens directly in the API
AUTH_MODE=gateway

# Dev mode - bypass authentication (for local development only!)
DEV_MODE=false

# -----------------------------------------------------------------------------
# OpenFGA Configuration (Fine-grained Authorization)
# -----------------------------------------------------------------------------
OPENFGA_URL=http://openfga:8080

# =============================================================================
# ARCHITECTURE OVERVIEW
# =============================================================================
#
# Request Flow:
#
# 1. Frontend (react-app/admin-app) sends request to Traefik Gateway (:4455)
#    with Authorization: Bearer <casdoor_jwt>
#
# 2. Traefik calls AuthZ service (/gate) via ForwardAuth
#
# 3. AuthZ service:
#    - Validates Casdoor JWT token
#    - Extracts user info from token claims
#    - Optionally checks OpenFGA for fine-grained permissions
#    - Returns user context as headers (X-User-ID, X-Tenant-ID, etc.)
#
# 4. Traefik forwards request to sample-api with auth headers
#
# 5. Sample-api trusts headers and processes the request
#
# =============================================================================
# SETUP INSTRUCTIONS
# =============================================================================
#
# 1. Copy this file to .env:
#    cp .env.example .env
#
# 2. Start the services:
#    docker compose up -d
#
# 3. Default admin login:
#    - Email: admin@localhost
#    - Password: admin123
#    - IMPORTANT: Change this password immediately after first login!
#
# 4. Configure social login (optional):
#    - In Casdoor, go to Providers > Add Provider
#    - Select provider type (Google, GitHub, etc.)
#    - Enter your OAuth credentials
#    - Link the provider to your application
#
# 5. Configure enterprise SSO (optional):
#    - In Casdoor, go to Providers > Add Provider
#    - Select OIDC, SAML, or LDAP
#    - Configure your enterprise IDP settings
#
# 6. Rebuild and restart:
#    docker compose up -d --build
#
# 7. Access the applications:
#    - User App: http://localhost:3000
#    - Admin Portal: http://localhost:3001
#    - API Gateway: http://localhost:4455
#    - Traefik Dashboard: http://localhost:8180
#    - Casdoor Admin: internal only (see step 3 for access)
#    - OpenFGA Playground: http://localhost:3002
#
# =============================================================================
